<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>BizFlow - H·ªá th·ªëng Qu·∫£n l√Ω V·∫≠t li·ªáu X√¢y d·ª±ng</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, sans-serif; margin: 0; display: flex; height: 100vh; background: #f0f2f5; }
        .sidebar { width: 260px; background: #2c3e50; color: white; padding: 20px; display: flex; flex-direction: column; }
        .sidebar h2 { color: #3498db; text-align: center; margin-bottom: 20px; border-bottom: 1px solid #3e4f5f; padding-bottom: 10px; }
        
        .role-box { background: #34495e; padding: 10px; border-radius: 8px; margin-bottom: 20px; font-size: 13px; }
        .role-box select { width: 100%; background: #2c3e50; color: #3498db; border: none; padding: 5px; border-radius: 4px; cursor: pointer; }

        .menu-item { padding: 15px; cursor: pointer; border-radius: 8px; margin-bottom: 8px; transition: 0.3s; }
        .menu-item:hover, .active { background: #34495e; color: #3498db; }
        .content { flex: 1; padding: 30px; overflow-y: auto; }
        .card { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); margin-bottom: 25px; }
        .hidden { display: none; }
        h3 { margin-top: 0; color: #2c3e50; border-left: 5px solid #3498db; padding-left: 15px; }
        
        textarea { width: 100%; height: 100px; padding: 15px; border: 1px solid #ddd; border-radius: 10px; font-size: 16px; box-sizing: border-box; }
        .btn-ai { background: #8e44ad; color: white; border: none; padding: 14px; border-radius: 8px; cursor: pointer; font-weight: bold; width: 100%; margin-top: 10px; }
        
        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        th, td { text-align: left; padding: 12px; border-bottom: 1px solid #eee; }
        .badge-type { padding: 3px 8px; border-radius: 4px; font-size: 11px; font-weight: bold; background: #eef2f7; color: #3498db; }
        .owner-feature { border-left: 3px solid #e74c3c !important; } 
    </style>
</head>
<body>

<div class="sidebar">
    <h2>BizFlow MVP</h2>
    <div class="role-box">
        <label>Ch·∫ø ƒë·ªô xem:</label>
        <select id="user-role" onchange="syncSystem()">
            <option value="owner">Ch·ªß c·ª≠a h√†ng (Full)</option>
            <option value="employee">Nh√¢n vi√™n (Limited)</option>
        </select>
    </div>
    <div class="menu-item active" onclick="showTab('ai-tab')">ü§ñ AI T·∫°o ƒê∆°n H√†ng</div>
    <div class="menu-item" onclick="showTab('product-tab')">üì¶ Qu·∫£n l√Ω S·∫£n ph·∫©m</div>
    <div class="menu-item" onclick="showTab('order-tab')">üìã Danh s√°ch ƒê∆°n h√†ng</div>
    <div id="nav-report" class="menu-item" onclick="showTab('report-tab')">üìä B√°o c√°o Doanh thu</div>
</div>

<div class="content">
    <div id="ai-tab" class="tab-content">
        <div class="card">
            <h3>ü§ñ Tr·ª£ l√Ω AI (Zalo/Voice)</h3>
            <textarea id="ai-input" placeholder="V√≠ d·ª•: An l·∫•y 50 bao xi mang, B√¨nh l·∫•y 2 xe c√°t..."></textarea>
            <button class="btn-ai" onclick="analyzeOrder()">üöÄ PH√ÇN T√çCH ƒê∆†N H√ÄNG</button>
            
            <div id="ai-result" style="display:none; margin-top:20px; padding:20px; border:2px dashed #8e44ad; border-radius:10px;">
                <div style="margin-bottom:15px; background:#fffbe6; padding:10px; border-radius:8px;">
                    <b>Ch·ªçn lo·∫°i kh√°ch:</b> 
                    <input type="radio" name="cust-type" id="t-quen" checked onclick="setOrderType('Quen')"> Kh√°ch quen
                    <input type="radio" name="cust-type" id="t-vang" onclick="setOrderType('V√£ng lai')"> V√£ng lai
                </div>
                <div id="ai-details" style="line-height: 2;"></div>
                <button onclick="confirmOrder()" style="background:#27ae60; color:white; border:none; padding:12px 25px; border-radius:8px; margin-top:10px; cursor:pointer; font-weight:bold;">X√ÅC NH·∫¨N & TR·ª™ KHO</button>
            </div>
        </div>
    </div>

    <div id="product-tab" class="tab-content hidden">
        <div class="card">
            <h3>üì¶ Kho h√†ng V·∫≠t li·ªáu x√¢y d·ª±ng</h3>
            <table>
                <thead><tr><th>S·∫£n ph·∫©m</th><th>M√£ SKU</th><th>Gi√° b√°n</th><th>T·ªìn kho</th><th class="owner-only">Thao t√°c</th></tr></thead>
                <tbody id="p-list"></tbody>
            </table>
        </div>
    </div>

    <div id="order-tab" class="tab-content hidden">
        <div class="card">
            <h3>üìã L·ªãch s·ª≠ ƒê∆°n h√†ng</h3>
            <table>
                <thead><tr><th>M√£</th><th>Kh√°ch h√†ng</th><th>Lo·∫°i</th><th>Chi ti·∫øt</th><th>T·ªïng</th><th class="owner-only">Thao t√°c</th></tr></thead>
                <tbody id="o-list"></tbody>
            </table>
        </div>
    </div>

    <div id="report-tab" class="tab-content hidden">
        <div class="card owner-feature">
            <h3>üìä B√°o c√°o Doanh thu (Ch·ªâ d√†nh cho Ch·ªß)</h3>
            <div id="revenue-chart" style="display:flex; gap:15px; align-items:flex-end; height:180px; border-bottom:2px solid #eee; padding-bottom: 10px;"></div>
            <div id="chart-labels" style="display:flex; gap:15px; justify-content: space-between; font-size: 10px; margin-top: 10px; color: #7f8c8d;"></div>
        </div>
    </div>
</div>

<script>
    // B·ªî SUNG TH√äM S·∫¢N PH·∫®M THEO Y√äU C·∫¶U
    let products = [
        { id: 1, name: "Xi mƒÉng H√† Ti√™n PCB40", sku: "XM-HT", price: 95000, stock: 500, rev: 0, color: "#3498db" },
        { id: 2, name: "G·∫°ch ·ªëng Tuynel (8x18)", sku: "G-TY", price: 1200, stock: 10000, rev: 0, color: "#e67e22" },
        { id: 3, name: "C√°t x√¢y d·ª±ng (Xe 2m3)", sku: "C-XD", price: 650000, stock: 20, rev: 0, color: "#f1c40f" },
        { id: 4, name: "S·∫Øt Phi 10 (C√¢y 11.7m)", sku: "S-P10", price: 115000, stock: 150, rev: 0, color: "#95a5a6" },
        { id: 5, name: "ƒê√° 1x2 (Xe 2m3)", sku: "D-12", price: 580000, stock: 15, rev: 0, color: "#34495e" },
        { id: 6, name: "T√¥n k·∫Ωm hoa sen (m)", sku: "T-HS", price: 75000, stock: 300, rev: 0, color: "#2ecc71" }
    ];
    
    let orders = [];
    let cur = null;

    function syncSystem() {
        const role = document.getElementById('user-role').value;
        const ownerUIs = document.querySelectorAll('.owner-only');
        const reportNav = document.getElementById('nav-report');

        if (role === 'employee') {
            ownerUIs.forEach(el => el.style.display = 'none');
            reportNav.style.display = 'none';
            showTab('ai-tab');
        } else {
            ownerUIs.forEach(el => el.style.display = '');
            reportNav.style.display = '';
        }
        renderUI();
    }

    function showTab(id) {
        document.querySelectorAll('.tab-content').forEach(t => t.classList.add('hidden'));
        document.querySelectorAll('.menu-item').forEach(m => m.classList.remove('active'));
        document.getElementById(id).classList.remove('hidden');
        if(event) event.currentTarget.classList.add('active');
        if(id === 'report-tab') renderChart();
    }

    function analyzeOrder() {
        const text = document.getElementById('ai-input').value.toLowerCase();
        // C·∫£i ti·∫øn AI t√¨m ki·∫øm theo t·ª´ kh√≥a trong danh s√°ch s·∫£n ph·∫©m m·ªõi
        let pFound = products.find(p => {
            let shortName = p.name.toLowerCase().split(' ')[0];
            return text.includes(shortName) || text.includes(p.sku.toLowerCase());
        });
        
        const qty = parseInt(text.match(/\d+/) || "0");
        const words = text.split(' ');
        let name = (isNaN(words[0])) ? words[0].toUpperCase() : "KH√ÅCH V√ÉNG LAI";

        if (pFound && qty > 0) {
            cur = { p: pFound, qty: qty, customer: name, total: qty * pFound.price, type: 'Quen' };
            document.getElementById('ai-result').style.display = 'block';
            updateAIDetails();
        } else {
            alert("AI kh√¥ng t√¨m th·∫•y s·∫£n ph·∫©m n√†y trong kho!");
        }
    }

    function setOrderType(t) { cur.type = t; updateAIDetails(); }
    function updateAIDetails() {
        document.getElementById('ai-details').innerHTML = `
            üë§ <b>T√™n kh√°ch:</b> ${cur.customer} <br>
            üè∑Ô∏è <b>Ph√¢n lo·∫°i:</b> <span class="badge-type">${cur.type}</span> <br>
            üõí <b>S·∫£n ph·∫©m:</b> ${cur.p.name} <br>
            üî¢ <b>S·ªë l∆∞·ª£ng:</b> ${cur.qty} | üí∞ <b>T·ªïng:</b> ${cur.total.toLocaleString()}ƒë
        `;
    }

    function confirmOrder() {
        const p = products.find(x => x.id === cur.p.id);
        if (p.stock >= cur.qty) {
            p.stock -= cur.qty;
            p.rev += cur.total;
            orders.unshift({ 
                id: "BF"+Date.now().toString().slice(-4), 
                customer: cur.customer, 
                type: cur.type, 
                detail: cur.qty + " " + (p.sku), 
                total: cur.total.toLocaleString()+"ƒë" 
            });
            renderUI();
            alert("ƒê√£ x√°c nh·∫≠n ƒë∆°n h√†ng v√† c·∫≠p nh·∫≠t kho!");
            document.getElementById('ai-result').style.display = 'none';
            showTab('order-tab');
        } else { alert("Kho kh√¥ng ƒë·ªß h√†ng!"); }
    }

    function renderUI() {
        const isOwner = document.getElementById('user-role').value === 'owner';
        
        document.getElementById('p-list').innerHTML = products.map(p => `
            <tr>
                <td>${p.name}</td><td><code>${p.sku}</code></td><td>${p.price.toLocaleString()}</td>
                <td><b style="color:${p.stock < 10 ? 'red' : '#27ae60'}">${p.stock}</b></td>
                <td class="owner-only" style="display:${isOwner?'':'none'}">
                    <button onclick="alert('S·ª≠a...')">‚úèÔ∏è</button>
                </td>
            </tr>
        `).join('');

        document.getElementById('o-list').innerHTML = orders.map(o => `
            <tr>
                <td>${o.id}</td><td>${o.customer}</td><td><span class="badge-type">${o.type}</span></td>
                <td>${o.detail}</td><td>${o.total}</td>
                <td class="owner-only" style="display:${isOwner?'':'none'}"><button onclick="alert('X√≥a...')">‚úñ</button></td>
            </tr>
        `).join('');
    }

    function renderChart() {
        const max = Math.max(...products.map(p => p.rev), 1000000);
        document.getElementById('revenue-chart').innerHTML = products.map(p => `
            <div style="flex:1; background:${p.color}; height:${(p.rev/max)*100}%; position:relative; border-radius: 4px 4px 0 0;">
                <div style="position:absolute; top:-25px; width:100%; text-align:center; font-size:11px; font-weight:bold;">${(p.rev/1000).toFixed(0)}k</div>
            </div>
        `).join('');
        
        document.getElementById('chart-labels').innerHTML = products.map(p => `
            <div style="flex:1; text-align:center; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">${p.sku}</div>
        `).join('');
    }

    syncSystem();
</script>
</body>
</html>